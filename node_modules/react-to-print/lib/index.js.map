{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import React from \"react\";\nimport { findDOMNode } from \"react-dom\";\nimport PropTypes from \"prop-types\";\n\nclass ReactToPrint extends React.Component {\n\n  static propTypes = {\n    /** Copy styles over into print window. default: true */\n    copyStyles: PropTypes.bool, \n    /** Trigger action used to open browser print */\n    trigger: PropTypes.func.isRequired,\n    /** Content to be printed */\n    content: PropTypes.func.isRequired,\n    /** Callback function to trigger before print */\n    onBeforePrint: PropTypes.func,\n    /** Callback function to trigger after print */\n    onAfterPrint: PropTypes.func\n  };\n\n  static defaultProps = {\n    copyStyles: true\n  };\n\n  triggerPrint(target) {\n    if (this.props.onBeforePrint) {\n      this.props.onBeforePrint();\n    }\n    setTimeout(() => {\n      target.print();\n      target.close();\n    }, 500);\n  }\n\n  handlePrint = () => {\n  \n    const {\n      content,\n      copyStyles,\n      onAfterPrint\n    } = this.props;\n\n    let printWindow = window.open(\"\", \"Print\", \"status=no, toolbar=no, scrollbars=yes\", \"false\");\n    \n    if (onAfterPrint) {\n      printWindow.onbeforeunload = onAfterPrint;\n    }\n\n    const contentEl = content();\n    const contentNodes = findDOMNode(contentEl);\n\n    const imageNodes = [...contentNodes.getElementsByTagName(\"img\")];\n    const linkNodes = document.querySelectorAll('link[rel=\"stylesheet\"]');\n\n    this.imageTotal = imageNodes.length;\n    this.imageLoaded = 0;\n\n    this.linkTotal = linkNodes.length;\n    this.linkLoaded = 0;\n\n    const markLoaded = (type) => {\n\n      if (type === 'image')\n        this.imageLoaded++;\n      else if (type === 'link')\n        this.linkLoaded++;\n\n      if (this.imageLoaded === this.imageTotal && this.linkLoaded === this.linkTotal) {\n        this.triggerPrint(printWindow);\n      }\n\n    };\n\n    [...imageNodes].forEach((child) => {\n      /** Workaround for Safari if the image has base64 data as a source */\n      if (/^data:/.test(child.src)) {\n        child.crossOrigin = 'anonymous';\n      }\n      child.setAttribute('src', child.src);\n      child.onload = markLoaded.bind(null, 'image');\n      child.onerror = markLoaded.bind(null, 'image');\n      child.crossOrigin = 'use-credentials';\n    });\n\n    /*\n     * IE does not seem to allow appendChild from different window contexts correctly.  They seem to come back\n     * as plain objects. In order to get around this each tag is re-created into the printWindow\n     * https://stackoverflow.com/questions/38708840/calling-adoptnode-and-importnode-on-a-child-window-fails-in-ie-and-edge\n     */\n    if (copyStyles !== false) {\n\n      const headEls = document.querySelectorAll('style, link[rel=\"stylesheet\"]');\n      [...headEls].forEach(node => { \n      \n        let newHeadEl = printWindow.document.createElement(node.tagName);\n\n        if (node.textContent)\n          newHeadEl.textContent = node.textContent;\n        else if (node.innerText)\n          newHeadEl.innerText = node.innerText;\n  \n        let attributes = [...node.attributes];\n        attributes.forEach(attr => {\n\n          let nodeValue = attr.nodeValue;\n\n          if (attr.nodeName === 'href' && /^https?:\\/\\//.test(attr.nodeValue) === false) {\n            \n            const relPath = attr.nodeValue.substr(0, 3) === \"../\" \n              ? document.location.pathname.replace(/[^/]*$/, '') \n              : \"/\";\n            \n            nodeValue = document.location.protocol + '//' + document.location.host + relPath + nodeValue;\n            \n          }\n\n          newHeadEl.setAttribute(attr.nodeName, nodeValue);\n        });\n\n        if (node.tagName === 'LINK') {\n          newHeadEl.onload = markLoaded.bind(null, 'link');\n          newHeadEl.onerror = markLoaded.bind(null, 'link');          \n        }\n\n        printWindow.document.head.appendChild(newHeadEl);\n\n      });\n\n    }\n\n    if (document.body.className) {\n      const bodyClasses = document.body.className.split(\" \");\n      bodyClasses.map(item => printWindow.document.body.classList.add(item));\n    }\n\n    /* remove date/time from top */\n    let styleEl = printWindow.document.createElement('style');\n    styleEl.appendChild(printWindow.document.createTextNode(\"@page { size: auto;  margin: 0mm; } @media print { body { -webkit-print-color-adjust: exact; } }\"));\n\n    printWindow.document.head.appendChild(styleEl);\n    printWindow.document.body.innerHTML = contentNodes.outerHTML;\n\n    if (this.imageTotal === 0 || copyStyles === false) {\n      this.triggerPrint(printWindow);\n    }\n\n  }\n\n  render() {\n\n    return React.cloneElement(this.props.trigger(), {\n     ref: (el) => this.triggerRef = el,\n     onClick: this.handlePrint\n    });\n\n  }\n\n}\n\nexport default ReactToPrint;\n"],"names":["ReactToPrint","handlePrint","_this","props","content","copyStyles","onAfterPrint","printWindow","window","open","onbeforeunload","contentEl","contentNodes","findDOMNode","imageNodes","getElementsByTagName","linkNodes","document","querySelectorAll","imageTotal","length","imageLoaded","linkTotal","linkLoaded","markLoaded","type","triggerPrint","forEach","child","test","src","crossOrigin","setAttribute","onload","bind","onerror","headEls","newHeadEl","createElement","node","tagName","textContent","innerText","attributes","nodeValue","attr","nodeName","relPath","substr","location","pathname","replace","protocol","host","head","appendChild","body","className","split","map","classList","add","item","styleEl","createTextNode","innerHTML","outerHTML","target","this","onBeforePrint","print","close","React","cloneElement","trigger","el","_this2","triggerRef","Component","defaultProps"],"mappings":"+sCAIMA,mQA6BJC,YAAc,iBAMRC,EAAKC,MAHPC,IAAAA,QACAC,IAAAA,WACAC,IAAAA,aAGEC,EAAcC,OAAOC,KAAK,GAAI,QAAS,wCAAyC,SAEhFH,MACUI,eAAiBJ,OAGzBK,EAAYP,IACZQ,EAAeC,qBAAYF,GAE3BG,8BAAiBF,EAAaG,qBAAqB,SACnDC,EAAYC,SAASC,iBAAiB,4BAEvCC,WAAaL,EAAWM,SACxBC,YAAc,IAEdC,UAAYN,EAAUI,SACtBG,WAAa,MAEZC,EAAa,SAACC,GAEL,UAATA,EACFvB,EAAKmB,cACW,SAATI,GACPvB,EAAKqB,aAEHrB,EAAKmB,cAAgBnB,EAAKiB,YAAcjB,EAAKqB,aAAerB,EAAKoB,aAC9DI,aAAanB,mCAKlBO,IAAYa,QAAQ,SAACC,GAEnB,SAASC,KAAKD,EAAME,SAChBC,YAAc,eAEhBC,aAAa,MAAOJ,EAAME,OAC1BG,OAAST,EAAWU,KAAK,KAAM,WAC/BC,QAAUX,EAAWU,KAAK,KAAM,WAChCH,YAAc,qBAQH,IAAf1B,EAAsB,KAElB+B,EAAUnB,SAASC,iBAAiB,6DACtCkB,IAAST,QAAQ,gBAEfU,EAAY9B,EAAYU,SAASqB,cAAcC,EAAKC,SAEpDD,EAAKE,YACPJ,EAAUI,YAAcF,EAAKE,YACtBF,EAAKG,YACZL,EAAUK,UAAYH,EAAKG,uCAERH,EAAKI,aACfhB,QAAQ,gBAEbiB,EAAYC,EAAKD,aAEC,SAAlBC,EAAKC,WAA+D,IAAxC,eAAejB,KAAKgB,EAAKD,WAAsB,KAEvEG,EAA0C,QAAhCF,EAAKD,UAAUI,OAAO,EAAG,GACrC/B,SAASgC,SAASC,SAASC,QAAQ,SAAU,IAC7C,MAEQlC,SAASgC,SAASG,SAAW,KAAOnC,SAASgC,SAASI,KAAON,EAAUH,IAI3EZ,aAAaa,EAAKC,SAAUF,KAGnB,SAAjBL,EAAKC,YACGP,OAAST,EAAWU,KAAK,KAAM,UAC/BC,QAAUX,EAAWU,KAAK,KAAM,WAGhCjB,SAASqC,KAAKC,YAAYlB,QAMtCpB,SAASuC,KAAKC,UAAW,CACPxC,SAASuC,KAAKC,UAAUC,MAAM,KACtCC,IAAI,mBAAQpD,EAAYU,SAASuC,KAAKI,UAAUC,IAAIC,SAI9DC,EAAUxD,EAAYU,SAASqB,cAAc,WACzCiB,YAAYhD,EAAYU,SAAS+C,eAAe,uGAE5C/C,SAASqC,KAAKC,YAAYQ,KAC1B9C,SAASuC,KAAKS,UAAYrD,EAAasD,UAE3B,IAApBhE,EAAKiB,aAAmC,IAAfd,KACtBqB,aAAanB,8GAvHT4D,GACPC,KAAKjE,MAAMkE,oBACRlE,MAAMkE,2BAEF,aACFC,UACAC,SACN,wDAuHIC,MAAMC,aAAaL,KAAKjE,MAAMuE,eAC/B,SAACC,UAAOC,EAAKC,WAAaF,WACtBP,KAAKnE,qBAnJQuE,MAAMM,WAA3B9E,aAeG+E,0BACO"}